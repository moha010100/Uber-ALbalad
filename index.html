<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Uber Albalad</title>

    <!-- ====== CSS ======= -->
    <style>
        body {
            margin: 0;
            background: #f5f5f5;
            font-family: Arial, sans-serif;
        }

        /* ===== شريط علوي ===== */
        .navbar {
            background: #ffd500;
            padding: 15px 25px;
            font-size: 24px;
            font-weight: bold;
            color: #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .admin-btn {
            background: #000;
            color: #ffd500;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* ===== الحاويات ===== */
        .container {
            width: 92%;
            margin: auto;
            margin-top: 20px;
            display: flex;
            gap: 20px;
        }

        /* ===== الطلبات ===== */
        .orders-box {
            width: 70%;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.15);
        }

        .order-card {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            background: #f0f0f0;
            padding: 12px;
            border-radius: 12px;
        }

        .order-img {
            width: 180px;
            height: 180px;
            object-fit: cover;
            border-radius: 12px;
            background: #ddd;
        }

        /* ===== لوحة المشرف ===== */
        .admin-panel {
            width: 30%;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.15);
        }

        .hidden {
            display: none;
        }

        /* ===== نافذة إضافة الطلب ===== */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
        }
        .modal-box {
            width: 90%;
            max-width: 400px;
            background: white;
            padding: 20px;
            border-radius: 15px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: 1px solid #aaa;
        }
        .btn {
            padding: 10px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn-blue { background: #007bff; color: #fff; }
        .btn-red { background: red; color: #fff; }
    </style>
</head>

<body>

    <!-- شريط الموقع -->
    <div class="navbar">
        Uber Albalad
        <div class="admin-btn" id="adminOpen">المشرفين</div>
    </div>

    <!-- الحاوية الأساسية -->
    <div class="container">
        <div class="orders-box">
            <h2>قائمة الطلبات</h2>
            <div id="ordersList">جاري التحميل...</div>
        </div>

        <div class="admin-panel hidden" id="adminPanel">
            <h3>لوحة المشرف</h3>

            <button class="btn btn-blue" id="addOrder">إضافة طلب</button>
            <button class="btn btn-red" id="logout">تسجيل خروج</button>
        </div>
    </div>

    <!-- نافذة إضافة الطلب -->
    <div class="modal" id="orderModal">
        <div class="modal-box">
            <h3>إضافة طلب جديد</h3>
            <input type="text" id="orderName" placeholder="اسم الطلب">
            <input type="text" id="deliveryNum" placeholder="رقم الديلفري">
            <input type="file" id="orderImg">
            <button class="btn btn-blue" id="saveOrder">حفظ</button>
            <button class="btn btn-red" id="closeModal">إلغاء</button>
        </div>
    </div>

    <!-- ============ Firebase + JavaScript ============= -->
    <script type="module">

        /*================ Firebase Setup ================*/
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as sRef, uploadBytes, getDownloadURL }
            from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAbMI7WprkW6WQeXp_XFToSELGnKu49OfQ",
            authDomain: "uber-albalad.firebaseapp.com",
            databaseURL: "https://uber-albalad-default-rtdb.firebaseio.com",
            projectId: "uber-albalad",
            storageBucket: "uber-albalad.firebasestorage.app",
            messagingSenderId: "848401880868",
            appId: "1:848401880868:web:5801175b6991ff1ea005b1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);

        /*================= UI Elements =================*/
        const adminPanel = document.getElementById("adminPanel");
        const adminOpen = document.getElementById("adminOpen");
        const logoutBtn = document.getElementById("logout");

        const modal = document.getElementById("orderModal");
        const addOrderBtn = document.getElementById("addOrder");
        const closeModal = document.getElementById("closeModal");
        const saveOrder = document.getElementById("saveOrder");

        /*================= Admin Login =================*/
        adminOpen.onclick = function () {
            let code = prompt("ادخل كود المشرف:");
            if (code === "010100") {
                sessionStorage.setItem("admin", "true");
                adminPanel.classList.remove("hidden");
                alert("تم تسجيل الدخول.");
            } else {
                alert("كود خاطئ!");
            }
        };

        if (sessionStorage.getItem("admin") === "true") {
            adminPanel.classList.remove("hidden");
        }

        logoutBtn.onclick = function () {
            sessionStorage.removeItem("admin");
            adminPanel.classList.add("hidden");
            alert("تم تسجيل الخروج");
        };

        /*================= Show Add Modal =================*/
        addOrderBtn.onclick = () => modal.style.display = "flex";
        closeModal.onclick = () => modal.style.display = "none";

        /*================= Save Order =================*/
        saveOrder.onclick = async function () {

            let name = document.getElementById("orderName").value;
            let delivery = document.getElementById("deliveryNum").value;
            let file = document.getElementById("orderImg").files[0];

            if (!name || !delivery || !file) {
                alert("ادخل جميع البيانات!");
                return;
            }

            // رفع الصورة
            const imgRef = sRef(storage, "orders/" + Date.now());
            await uploadBytes(imgRef, file);
            let imageURL = await getDownloadURL(imgRef);

            // حفظ الطلب
            push(ref(db, "orders"), {
                name,
                delivery,
                image: imageURL
            });

            modal.style.display = "none";
            alert("تم حفظ الطلب!");
        };

        /*================= Load Orders Real Time =================*/
        const ordersList = document.getElementById("ordersList");

        onValue(ref(db, "orders"), snapshot => {
            if (!snapshot.exists()) {
                ordersList.innerHTML = "لا توجد طلبات حاليا";
                return;
            }

            let html = "";
            snapshot.forEach(order => {
                let data = order.val();

                html += `
                    <div class="order-card">
                        <img class="order-img" src="${data.image}">
                        <div>
                            <h3>${data.name}</h3>
                            <p>الدليفري: ${data.delivery}</p>
                        </div>
                    </div>
                `;
            });

            ordersList.innerHTML = html;
        });

    </script>

</body>
</html>
